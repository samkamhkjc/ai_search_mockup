<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 模式 - AI Search POC</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="ai-mode-page">
  <header class="ai-mode-header">
    <a href="index.html" class="logo-small" aria-label="返回搜尋首頁">AI Search POC</a>
    <span class="ai-mode-badge">AI 模式</span>
  </header>
  <main class="ai-mode-main">
    <div id="content" class="ai-mode-content-wrap">
      <!-- Static mockup: two-turn conversation -->
      <!-- Turn 1: 賽馬博物館在哪裏？ -->
      <section class="ai-mode-turn ai-mode-user-turn">
        <div class="ai-mode-query-bubble">賽馬博物館在哪裏？</div>
      </section>
      <section class="ai-mode-turn ai-mode-model-turn">
        <div class="ai-mode-response-layout">
          <div class="ai-mode-response-body">
            <div class="ai-mode-response-text" id="aiModeResponse1"></div>
          </div>
          <aside class="ai-mode-citations-sidebar">
            <div class="ai-mode-citations-header">
              <span class="ai-mode-citations-count" id="aiModeCount1">3 個網站</span>
              <button type="button" class="ai-mode-citations-pin" aria-label="釘選"><svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"/></svg></button>
              <button type="button" class="ai-mode-citations-menu" aria-label="更多"><svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg></button>
            </div>
            <div class="ai-mode-citations-cards" id="aiModeCitationsList1"></div>
            <button type="button" class="ai-mode-show-all">顯示全部</button>
          </aside>
        </div>
      </section>
      <!-- Turn 2: 沙田馬場怎麽去 -->
      <section class="ai-mode-turn ai-mode-user-turn">
        <div class="ai-mode-query-bubble">沙田馬場怎麽去</div>
      </section>
      <section class="ai-mode-turn ai-mode-model-turn">
        <div class="ai-mode-response-layout">
          <div class="ai-mode-response-body">
            <div class="ai-mode-response-text" id="aiModeResponse2"></div>
          </div>
          <aside class="ai-mode-citations-sidebar">
            <div class="ai-mode-citations-header">
              <span class="ai-mode-citations-count" id="aiModeCount2">3 個網站</span>
              <button type="button" class="ai-mode-citations-pin" aria-label="釘選"><svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"/></svg></button>
              <button type="button" class="ai-mode-citations-menu" aria-label="更多"><svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg></button>
            </div>
            <div class="ai-mode-citations-cards" id="aiModeCitationsList2"></div>
            <button type="button" class="ai-mode-show-all">顯示全部</button>
          </aside>
        </div>
      </section>
    </div>
    <footer class="ai-mode-footer">
      <form class="ai-mode-next-form" id="aiModeNextForm" action="ai-mode.html" method="get">
        <label for="aiModeQuerySelect" class="visually-hidden">繼續以 AI 模式探討</label>
        <div class="ai-mode-input-row">
          <select name="q" id="aiModeQuerySelect" aria-label="選擇查詢">
            <option value="">選擇其他問題深入探討...</option>
            <option value="racing-museum">賽馬博物館在哪裏？</option>
            <option value="sha-tin-how-to-get">沙田馬場怎麽去</option>
          </select>
          <button type="submit" class="ai-mode-submit-btn">深入探討</button>
        </div>
      </form>
    </footer>
  </main>
  <script>
    (function () {
      function esc(s) {
        if (!s) return '';
        var d = document.createElement('div');
        d.textContent = s;
        return d.innerHTML;
      }
      function getSourceName(url) {
        try {
          var a = document.createElement('a');
          a.href = url;
          return a.hostname.replace(/^www\./, '') || '來源';
        } catch (e) { return '來源'; }
      }
      function renderTurn(overview, results, textEl, listEl) {
        var safe = overview.split('\n').map(function(p) {
          var t = esc(p.trim());
          if (!t) return '';
          if (t.length < 25 && t.indexOf('[') === -1) return '<strong class="ai-mode-heading">' + t + '</strong>';
          return t;
        }).join('<br>');
        var withCitations = safe.replace(/\[(\d+)\]/g, function(_, n) {
          var idx = parseInt(n, 10) - 1;
          if (idx < 0 || !results[idx]) return '[' + n + ']';
          var r = results[idx];
          return ' <a href="' + esc(r.url) + '" target="_blank" rel="noopener" class="ai-mode-citation-pill" title="' + esc(r.title) + '">' + esc(r.sourceName || getSourceName(r.url)) + '</a>';
        });
        textEl.innerHTML = withCitations;
        var cited = [];
        overview.replace(/\[(\d+)\]/g, function(_, n) {
          var i = parseInt(n, 10);
          if (cited.indexOf(i) === -1) cited.push(i);
          return _;
        });
        cited.sort(function(a, b) { return a - b; });
        var cardsHtml = '';
        for (var i = 0; i < cited.length; i++) {
          var n = cited[i];
          var idx = n - 1;
          var r = results[idx];
          if (!r) continue;
          var sn = r.sourceName || getSourceName(r.url);
          var desc = r.snippet ? esc(r.snippet) : '';
          cardsHtml += '<a href="' + esc(r.url) + '" target="_blank" rel="noopener" class="ai-mode-source-card">' +
            '<span class="ai-mode-source-card-icon" aria-hidden="true"><svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></span>' +
            '<span class="ai-mode-source-card-content">' +
              '<span class="ai-mode-source-card-title">' + esc(r.title) + '</span>' +
              (desc ? '<span class="ai-mode-source-card-desc">' + desc + '</span>' : '') +
            '</span>' +
            '<span class="ai-mode-source-card-thumb"></span>' +
            '<span class="ai-mode-source-card-footer"><span class="ai-mode-source-name">' + esc(sn) + '</span><button type="button" class="ai-mode-source-card-menu" aria-label="更多" onclick="event.preventDefault();event.stopPropagation()"><svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg></button></span>' +
          '</a>';
        }
        listEl.innerHTML = cardsHtml;
      }

      var turn1 = {
        overview: "香港賽馬博物館位於跑馬地馬場的快活看台二樓 [2]。博物館展示了香港超過 170 年的賽馬歷史，並且免費入場 [2]。以下是前往博物館的詳細資訊：\n\n位置及開放時間\n地址：香港島跑馬地黃泥涌道，位於快活看台二樓 [1]。\n\n開放時間：星期一至星期日：中午 12 時至下午 6 時；夜間賽馬或黃昏賽馬日：中午 12 時至晚上 9 時 [1]。請注意：開放時間可能會因特別安排或賽馬日而有所調整，建議出發前查看香港賽馬會官方網站。\n\n入場費：免費 [1]。\n\n導賞服務：本館另提供免費導賞服務，每天下午 2 時 30 分開始，約 30 分鐘 [3]。",
        results: [
          { title: "參觀資料- 香港賽馬博物館- 馬會知多少- 香港賽馬會", url: "https://corporate.hkjc.com/corporate/chinese/history-and-reports/plan-your-visit.aspx", snippet: "開放時間、入場費、聯絡我們及地址。", sourceName: "香港賽馬會" },
          { title: "香港賽馬博物館- The Hong Kong Racing Museum - 馬會知多少- 香港賽馬會", url: "https://corporate.hkjc.com/corporate/chinese/history-and-reports/the-hong-kong-racing-museum.aspx", snippet: "香港賽馬博物館坐落跑馬地馬場，讓訪客細味香港賽馬170多年來的輝煌歷史。", sourceName: "香港賽馬會" },
          { title: "團體導賞服務- 香港賽馬博物館- 馬會知多少- 香港賽馬會", url: "https://corporate.hkjc.com/corporate/chinese/history-and-reports/group-tour.aspx", snippet: "免費導賞服務，每天下午2時30分，約30分鐘。", sourceName: "香港賽馬會" }
        ]
      };
      var turn2 = {
        overview: "前往沙田馬場（地址：新界沙田區火炭大埔公路沙田段 6001 號 [1]）共有以下四種交通方式：\n\n港鐵：可搭乘東鐵綫抵達。\n\n的士：直接乘搭的士前往。\n\n巴士及小巴：利用相關巴士或專線小巴路線。\n\n自駕：場內設有公眾停車場及會員停車場（後者僅供會員及其來賓使用）。\n\n請注意：賽事通常於週末及公眾假期舉行 [3]，入場時間為首場開跑前 2 小時 [2]。",
        results: [
          { title: "沙田馬場- 馬場活動- 香港賽馬會", url: "https://entertainment.hkjc.com/zh-hk/hospitality-venues/sha-tin-racecourse", snippet: "沙田馬場於1978年落成啟用，為主要日馬賽事場地。", sourceName: "香港賽馬會" },
          { title: "計劃行程- 沙田馬場- 馬場活動- 香港賽馬會", url: "https://entertainment.hkjc.com/zh-hk/visit-us/sha-tin-racecourse", snippet: "公眾席入場、開放時間為首場賽事開跑前2小時至尾場。", sourceName: "香港賽馬會" },
          { title: "馬場活動- 香港賽馬會", url: "https://entertainment.hkjc.com/", snippet: "世界級賽馬活動集中地，週末及假期上演日間賽事。", sourceName: "香港賽馬會" }
        ]
      };

      renderTurn(turn1.overview, turn1.results, document.getElementById('aiModeResponse1'), document.getElementById('aiModeCitationsList1'));
      renderTurn(turn2.overview, turn2.results, document.getElementById('aiModeResponse2'), document.getElementById('aiModeCitationsList2'));

      document.getElementById('aiModeNextForm').addEventListener('submit', function(e) {
        if (!document.getElementById('aiModeQuerySelect').value) e.preventDefault();
      });
    })();
  </script>
</body>
</html>
